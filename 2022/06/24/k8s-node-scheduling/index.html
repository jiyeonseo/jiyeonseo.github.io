<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>[K8S] Node 스케쥴링 - taint/cordon/drain | Daily Log</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/favicons/favicon-16x16.png">
    <link rel="shortcut icon" href="../assets/favicons/favicon.ico">
    <link rel="alternate" type="application/rss+xml" href="https://jiyeonseo.github.io/rss.xml" title="Daily Log RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://jiyeonseo.github.io/feed.atom" title="Daily Log Atom Feed">
    <link rel="alternate" type="application/json" href="https://jiyeonseo.github.io/feed.json" title="Daily Log JSON Feed">
    <meta name="description" content="
이슈 상황 및 해결

갑자기 application이 안된다고 연락이 와서 후다닥 pod들을 확인하였더니 다 Pending 상태로 멈춰있는 것을 확인했다. (진리의 껏키) 재배포를 시도하였으나, Pod이 Terminating도 아니고 그대로 쭉 Pending으로 멈춰있는 상태. kubectl describe pod  해 ...">
    
    <link rel="preload" href="/assets/css/0.styles.d9e965bb.css" as="style"><link rel="preload" href="/assets/js/app.ca882463.js" as="script"><link rel="preload" href="/assets/js/4.d48376ce.js" as="script"><link rel="preload" href="/assets/js/1.a7328d07.js" as="script"><link rel="preload" href="/assets/js/108.9c79596c.js" as="script"><link rel="prefetch" href="/assets/js/100.20349d4f.js"><link rel="prefetch" href="/assets/js/101.337c7ac5.js"><link rel="prefetch" href="/assets/js/102.df0c3b4c.js"><link rel="prefetch" href="/assets/js/103.9ab2bce5.js"><link rel="prefetch" href="/assets/js/104.a8cfe2ac.js"><link rel="prefetch" href="/assets/js/105.fbf41c7d.js"><link rel="prefetch" href="/assets/js/106.137693c5.js"><link rel="prefetch" href="/assets/js/107.7b67094d.js"><link rel="prefetch" href="/assets/js/109.8f827ec6.js"><link rel="prefetch" href="/assets/js/11.266ec168.js"><link rel="prefetch" href="/assets/js/110.d3557852.js"><link rel="prefetch" href="/assets/js/111.037463d3.js"><link rel="prefetch" href="/assets/js/112.71dfe16b.js"><link rel="prefetch" href="/assets/js/113.98586e30.js"><link rel="prefetch" href="/assets/js/114.b61c2291.js"><link rel="prefetch" href="/assets/js/115.013a015b.js"><link rel="prefetch" href="/assets/js/116.1b44155e.js"><link rel="prefetch" href="/assets/js/117.ba320cb6.js"><link rel="prefetch" href="/assets/js/118.bce8c1cf.js"><link rel="prefetch" href="/assets/js/119.4cfe496d.js"><link rel="prefetch" href="/assets/js/12.8f3a6060.js"><link rel="prefetch" href="/assets/js/120.df3465f8.js"><link rel="prefetch" href="/assets/js/121.2ab0ab3e.js"><link rel="prefetch" href="/assets/js/122.e84ca54f.js"><link rel="prefetch" href="/assets/js/123.c7c4409a.js"><link rel="prefetch" href="/assets/js/124.07b6783e.js"><link rel="prefetch" href="/assets/js/125.b1701c7a.js"><link rel="prefetch" href="/assets/js/126.0d92253e.js"><link rel="prefetch" href="/assets/js/127.007a575d.js"><link rel="prefetch" href="/assets/js/13.9ff4ae05.js"><link rel="prefetch" href="/assets/js/14.215024b0.js"><link rel="prefetch" href="/assets/js/15.0ff47d16.js"><link rel="prefetch" href="/assets/js/16.37e6c0ed.js"><link rel="prefetch" href="/assets/js/17.cbba4f66.js"><link rel="prefetch" href="/assets/js/18.b7e71dfe.js"><link rel="prefetch" href="/assets/js/19.c4464fe9.js"><link rel="prefetch" href="/assets/js/2.f8783da8.js"><link rel="prefetch" href="/assets/js/20.2dc08191.js"><link rel="prefetch" href="/assets/js/21.ff5f7b06.js"><link rel="prefetch" href="/assets/js/22.661f2a84.js"><link rel="prefetch" href="/assets/js/23.cf29033a.js"><link rel="prefetch" href="/assets/js/24.dd6f5bc6.js"><link rel="prefetch" href="/assets/js/25.9d7bdc46.js"><link rel="prefetch" href="/assets/js/26.3b8d6e0b.js"><link rel="prefetch" href="/assets/js/27.80928391.js"><link rel="prefetch" href="/assets/js/28.58a77b17.js"><link rel="prefetch" href="/assets/js/29.7f8113cb.js"><link rel="prefetch" href="/assets/js/3.487971c8.js"><link rel="prefetch" href="/assets/js/30.48f0ed8a.js"><link rel="prefetch" href="/assets/js/31.832b04d7.js"><link rel="prefetch" href="/assets/js/32.f05f003a.js"><link rel="prefetch" href="/assets/js/33.f9295acc.js"><link rel="prefetch" href="/assets/js/34.a80db534.js"><link rel="prefetch" href="/assets/js/35.abe84c23.js"><link rel="prefetch" href="/assets/js/36.4edabe0d.js"><link rel="prefetch" href="/assets/js/37.e7cfc869.js"><link rel="prefetch" href="/assets/js/38.aa1064e1.js"><link rel="prefetch" href="/assets/js/39.06859e09.js"><link rel="prefetch" href="/assets/js/40.7969b128.js"><link rel="prefetch" href="/assets/js/41.7daa36db.js"><link rel="prefetch" href="/assets/js/42.0b1c5b61.js"><link rel="prefetch" href="/assets/js/43.e741fcb4.js"><link rel="prefetch" href="/assets/js/44.212dc972.js"><link rel="prefetch" href="/assets/js/45.c68048f8.js"><link rel="prefetch" href="/assets/js/46.114afb81.js"><link rel="prefetch" href="/assets/js/47.862c6e14.js"><link rel="prefetch" href="/assets/js/48.c9b2f074.js"><link rel="prefetch" href="/assets/js/49.e7114482.js"><link rel="prefetch" href="/assets/js/5.bcd1442f.js"><link rel="prefetch" href="/assets/js/50.f467528a.js"><link rel="prefetch" href="/assets/js/51.f821ca96.js"><link rel="prefetch" href="/assets/js/52.649435a5.js"><link rel="prefetch" href="/assets/js/53.5b8dc67a.js"><link rel="prefetch" href="/assets/js/54.a0ca167c.js"><link rel="prefetch" href="/assets/js/55.3c3380f0.js"><link rel="prefetch" href="/assets/js/56.18549872.js"><link rel="prefetch" href="/assets/js/57.e19ed683.js"><link rel="prefetch" href="/assets/js/58.79fe55f7.js"><link rel="prefetch" href="/assets/js/59.4db8e029.js"><link rel="prefetch" href="/assets/js/6.49ca5872.js"><link rel="prefetch" href="/assets/js/60.9abd3c2e.js"><link rel="prefetch" href="/assets/js/61.e63ac9bb.js"><link rel="prefetch" href="/assets/js/62.6e924a53.js"><link rel="prefetch" href="/assets/js/63.9f33542a.js"><link rel="prefetch" href="/assets/js/64.38c313d2.js"><link rel="prefetch" href="/assets/js/65.fcfcf532.js"><link rel="prefetch" href="/assets/js/66.5012f3db.js"><link rel="prefetch" href="/assets/js/67.5b57b6b4.js"><link rel="prefetch" href="/assets/js/68.d99d5845.js"><link rel="prefetch" href="/assets/js/69.8107e489.js"><link rel="prefetch" href="/assets/js/7.a66f6791.js"><link rel="prefetch" href="/assets/js/70.27161263.js"><link rel="prefetch" href="/assets/js/71.761b94a6.js"><link rel="prefetch" href="/assets/js/72.531ebc5e.js"><link rel="prefetch" href="/assets/js/73.2c4b9c38.js"><link rel="prefetch" href="/assets/js/74.f50e9025.js"><link rel="prefetch" href="/assets/js/75.95a579c0.js"><link rel="prefetch" href="/assets/js/76.54cac59a.js"><link rel="prefetch" href="/assets/js/77.43aab426.js"><link rel="prefetch" href="/assets/js/78.f19c6ed1.js"><link rel="prefetch" href="/assets/js/79.5758ad17.js"><link rel="prefetch" href="/assets/js/8.b2bf099e.js"><link rel="prefetch" href="/assets/js/80.9a393ba1.js"><link rel="prefetch" href="/assets/js/81.53c49996.js"><link rel="prefetch" href="/assets/js/82.b94db98b.js"><link rel="prefetch" href="/assets/js/83.44f7bcdf.js"><link rel="prefetch" href="/assets/js/84.38740eee.js"><link rel="prefetch" href="/assets/js/85.75d98f53.js"><link rel="prefetch" href="/assets/js/86.cbe5c682.js"><link rel="prefetch" href="/assets/js/87.91edfd8c.js"><link rel="prefetch" href="/assets/js/88.a414f2e3.js"><link rel="prefetch" href="/assets/js/89.a0e02dc8.js"><link rel="prefetch" href="/assets/js/90.8df0fa19.js"><link rel="prefetch" href="/assets/js/91.30c58ca2.js"><link rel="prefetch" href="/assets/js/92.41dc4428.js"><link rel="prefetch" href="/assets/js/93.4dac8c5f.js"><link rel="prefetch" href="/assets/js/94.6f998976.js"><link rel="prefetch" href="/assets/js/95.fa78735e.js"><link rel="prefetch" href="/assets/js/96.46ebbc99.js"><link rel="prefetch" href="/assets/js/97.b91d70bf.js"><link rel="prefetch" href="/assets/js/98.08cf1b1d.js"><link rel="prefetch" href="/assets/js/99.f184a890.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.b53dac77.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d9e965bb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">Daily Log </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="nav-item"><a href="/about.html" class="nav-link">About Me</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">Daily Log </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="mobile-nav-item"><a href="/about.html" class="nav-link">About Me</a></li> <li class="mobile-nav-item"><a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        
      </h1> <div class="post-meta"><!----> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2022-06-24T00:00:00.000Z">
      2022-06-24
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/kubernetes" data-v-42ccfcd5><span data-v-42ccfcd5>kubernetes</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><h1 id="k8s-node-스케쥴링-taint-cordon-drain"><a href="#k8s-node-스케쥴링-taint-cordon-drain" class="header-anchor">#</a> [K8S] Node 스케쥴링 - taint/cordon/drain</h1> <h2 id="이슈-상황-및-해결"><a href="#이슈-상황-및-해결" class="header-anchor">#</a> 이슈 상황 및 해결</h2> <p>갑자기 application이 안된다고 연락이 와서 후다닥 pod들을 확인하였더니 다 <code>Pending</code> 상태로 멈춰있는 것을 확인했다. (진리의 껏키) 재배포를 시도하였으나, Pod이 <code>Terminating</code>도 아니고 그대로 쭉 <code>Pending</code>으로 멈춰있는 상태. <code>kubectl describe pod &lt;pod 이름&gt;</code> 해보니 아래와 같은 상태로 멈춰있었다.</p> <div class="language- extra-class"><pre class="language-text"><code>Type Reason Age From Message

---- ------ ---- ---- -------

Warning FailedScheduling 66s (x31 over 46m) default-scheduler 0/20 nodes are available: 17 node(s) were unschedulable, 3 node(s) had taints that the pod didn't tolerate.
</code></pre></div><p>가능한 노드가 없다. <code>kubectl get nodes</code>로 노드 상태를 확인해보았다.</p> <div class="language-sh extra-class"><pre class="language-sh"><code>
NAME STATUS ROLES AGE VERSION

cluster-e1 Ready controlplane,etcd 204d v1.14.6

cluster-e2 Ready controlplane,etcd 204d v1.14.6

cluster-e3 Ready controlplane,etcd 204d v1.14.6

cluster-w1 Ready,SchedulingDisabled worker 417d v1.14.6

cluster-w2 Ready,SchedulingDisabled worker 417d v1.14.6

cluster-w3 Ready,SchedulingDisabled worker 417d v1.14.6

</code></pre></div><p>worker node들이 모두 <code>SchedulingDisabled</code> 상태임을 확인했다.</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ kubectl uncordon <span class="token parameter variable">-l</span> node-role.kubernetes.io/worker<span class="token operator">=</span>true
</code></pre></div><p>worker node들에 대하여 <code>uncordon</code> 해주었고, <code>pending</code> 은 자연스럽게 풀리면서 정상화 되었다.</p> <h2 id="쿠버네티스-스케쥴링"><a href="#쿠버네티스-스케쥴링" class="header-anchor">#</a> 쿠버네티스 스케쥴링</h2> <p><img src="https://user-images.githubusercontent.com/2231510/175758120-7027210d-1435-47a6-a681-d2fb56889513.png" alt="스크린샷 2022-06-25 오후 1 34 46">
(ref: <a href="http://www.yes24.com/Product/Goods/93765519" target="_blank" rel="noopener noreferrer">시작하세요!도커/쿠버네티스<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</p> <ul><li>pod 생성시 어느 노드에 생성할 것인지 결정하는 일</li> <li>노드 필터링/ 노드 스코어링을 통해 최종적으로 어느 노드에 생성할 지 결정.
<ul><li>노드 필터링 : 할당 가능한지 아닌지. 가용 자원지 충분한 조건인지. <code>kubectl get nodes</code> 에서 STATUS가 Ready 인지 등</li> <li>노드 스코어링 : 쿠버네티스의 알고리즘 가중치에 따라 매겨짐. 도커 이미지가 이미 노드에 존재 하는지, 가용 자원이 많은 지 등</li></ul></li></ul> <h2 id="nodename-nodeselector"><a href="#nodename-nodeselector" class="header-anchor">#</a> nodeName, nodeSelector</h2> <p>Pod YAML에 어느 노드에 띄울 것인지 지정하면 스케쥴링에 의해서가 아니라 <strong>특정 워커 노드에 할당</strong>되게 만들 수 있다.</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ kubectl get nodes <span class="token comment"># node 이름 확인</span>

NAME STATUS ROLES AGE VERSION

<span class="token punctuation">..</span>.
cluster-w1 Ready worker 417d v1.14.6
<span class="token punctuation">..</span>.

</code></pre></div><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> hello
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">nodeName</span><span class="token punctuation">:</span> cluster<span class="token punctuation">-</span>w1
</code></pre></div><p>하지만 이렇게 하면 유연성에 좋지 못함. 그 노드가 잘못 되면?! 대신 라벨(Label)을 사용해 볼 수 있음.</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># label과 함께 node들 확인</span>
$ kubectl get nodes --show-labels

<span class="token comment"># node에 label 추가하기 </span>
$ kubectl label nodes <span class="token operator">&lt;</span>node<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>label<span class="token operator">&gt;</span>
$ kubectl label nodes cluster-w1 mylabel/disk<span class="token operator">=</span>hdd
</code></pre></div><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> hello
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span> 
    <span class="token key atrule">mylabel/disk</span><span class="token punctuation">:</span> hdd
</code></pre></div><ul><li>쿠버네티스 클러스터 운영시에 특정 노드에 문제가 생겨서 빼야한다던가 pod들을 이사 시키는 등 pod들이 특정 노드에 스케쥴링 되지 않도록 제한을 걸어 주어야 할 때가 있음. 이때 <code>taint</code>, <code>cordon</code>, <code>drain</code> 등을 사용하여 운영.</li></ul> <h2 id="taint-toleration"><a href="#taint-toleration" class="header-anchor">#</a> taint, toleration</h2> <ul><li><code>taint</code> 는 특정 노드에 '얼룩'을 지정하여 해당 노드에 pod가 할당 되는 것을 막는 것.</li> <li><code>taint</code> 가 되어있는 노드이지만 <code>용인</code>(toleration)된 pod은 할당이 가능하다.</li> <li><code>taint</code>는 노드 별로 설정 될 수도 있고, 특정 이벤트에 따라 쿠버네티스에서 자동으로 설정하기도 함.
<ul><li>기본적으로 마스터 노드는 pod이 할당되지 않도록 taint 설정되어있음.</li></ul> <div class="language- extra-class"><pre class="language-text"><code>$ kubectl describe node cluster-e1 

...
Taints:             node-role.kubernetes.io/master:NoSchedule
Unschedulable:      false # 스케쥴링 대상이 되는 노드다
...

</code></pre></div></li> <li>taint 설정은 라벨과 비슷하게 키=값 형태로 설정
<ul><li>다른점 : 뒤에 <code>:effect</code>가 붙음</li> <li><code>NoSchedule</code> : pod 스케쥴링 하지 않음</li> <li><code>NoExcute</code> : pod 실행 허용하지 않음</li> <li><code>PreferNoSchedule</code> : 가능하면 스케쥴링하지 않음</li></ul></li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>$ kubectl taint <span class="token function">node</span> <span class="token operator">&lt;</span>노드 이름<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>key<span class="token operator">=</span>value:effect<span class="token operator">&gt;</span>
$ kubectl taint <span class="token function">node</span> cluster-w1 cheese/taint<span class="token operator">=</span>dirty:NoSchedule

<span class="token comment"># taint 삭제 </span>
$ kubectl taint <span class="token function">node</span> <span class="token operator">&lt;</span>노드 이름<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>key:effect-<span class="token operator">&gt;</span>
</code></pre></div><p>만약, 이 node에 특정 pod을 용인(toleration) 해주려면 다음과 같이 yaml을 작성</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> hello
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">tolerations</span><span class="token punctuation">:</span> 
  <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> cheese/taint
    <span class="token key atrule">value</span><span class="token punctuation">:</span> dirty
    <span class="token key atrule">operator</span><span class="token punctuation">:</span> Equal   <span class="token comment"># cheese/taint 값이 dirty 이며</span>
    <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoSchedule    <span class="token comment"># Taint effect가 NoSchedule 인 경우 용인한다.   </span>
<span class="token punctuation">...</span>

</code></pre></div><ul><li>node 할당을 <strong>용인</strong> 한다는거지, 반드시 저 노드에 할당 된다는 뜻 X</li></ul> <h2 id="cordon-uncordon"><a href="#cordon-uncordon" class="header-anchor">#</a> cordon, uncordon</h2> <ul><li>위와 동일하게 스케쥴링 되는 것을 막는 방법. 다만 좀 더 명시적으로.</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>$ kubectl cordon <span class="token operator">&lt;</span>노드 이름<span class="token operator">&gt;</span>
$ kubectl cordon cluster-w1

$ kubectl get nodes
NAME STATUS ROLES AGE VERSION

<span class="token punctuation">..</span>.
cluster-w1 Ready,SchedulingDisabled worker 417d v1.14.6
<span class="token punctuation">..</span>.

$ kubectl describe <span class="token function">node</span> cluster-w1

<span class="token punctuation">..</span>.
Taints:             node.kubernetes.io/unschedulable:NoSchedule
Unschedulable:      <span class="token boolean">true</span> <span class="token comment"># 스케쥴링 대상이 안된다. </span>
<span class="token punctuation">..</span>.

</code></pre></div><ul><li>이미 해당 노드에 실행중인 pod은 종료되지는 않음.</li> <li>다시 스케쥴링 대상으로 넣으려면 아래와 같이 <code>uncordon</code> 할 수 있음.</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>$ kubectl uncordon <span class="token operator">&lt;</span>노드 이름<span class="token operator">&gt;</span>
$ kubectl uncordon cluster-w1

$ kubectl get nodes
NAME STATUS ROLES AGE VERSION

<span class="token punctuation">..</span>.
cluster-w1 Ready worker 417d v1.14.6
<span class="token punctuation">..</span>.
</code></pre></div><h2 id="drain"><a href="#drain" class="header-anchor">#</a> drain</h2> <ul><li>cordon과 비슷. 노드에서 <strong>기존 실행 중인 pod를 다른 노드로 옮겨가도록 퇴거(eviction) 수행.</strong></li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>$ kubectl drain <span class="token operator">&lt;</span>노드 이름<span class="token operator">&gt;</span>
$ kubectl drain cluster-w1

$ kubectl get nodes
NAME STATUS ROLES AGE VERSION

<span class="token punctuation">..</span>.
cluster-w1 Ready,SchedulingDisabled worker 417d v1.14.6
<span class="token punctuation">..</span>.

</code></pre></div><ul><li><p>만약 노드에 데몬셋으로 실행된 pod이 있으면 drain은 실패함.</p> <ul><li><code>--ignore-daemonsets=true</code> 옵션을 주면 무시함.</li></ul></li> <li><p>pod은 graceful 하게 종료 및 삭제.</p> <ul><li>kubelet을 통해 직접 실행된 <a href="https://kubernetes.io/ko/docs/tasks/configure-pod-container/static-pod/" target="_blank" rel="noopener noreferrer">static pod<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 들은 drain을 통해 삭제되지 않는다.</li></ul></li></ul> <p>더 자세한 내용은 <a href="https://kubernetes.io/ko/docs/concepts/scheduling-eviction/kube-scheduler/" target="_blank" rel="noopener noreferrer">쿠버네티스 스케쥴러 문서<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>를 참고할 수 있다.</p> <h2 id="references"><a href="#references" class="header-anchor">#</a> References</h2> <ul><li><p><a href="https://arisu1000.tistory.com/27845" target="_blank" rel="noopener noreferrer">https://arisu1000.tistory.com/27845<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://arisu1000.tistory.com/27846?category=787056" target="_blank" rel="noopener noreferrer">https://arisu1000.tistory.com/27846?category=787056<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://velog.io/@koo8624/Kubernetes-Drain-Cordon-and-Uncordon" target="_blank" rel="noopener noreferrer">https://velog.io/@koo8624/Kubernetes-Drain-Cordon-and-Uncordon<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#이슈-상황-및-해결" title="이슈 상황 및 해결">이슈 상황 및 해결</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#쿠버네티스-스케쥴링" title="쿠버네티스 스케쥴링">쿠버네티스 스케쥴링</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#nodename-nodeselector" title="nodeName, nodeSelector">nodeName, nodeSelector</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#taint-toleration" title="taint, toleration">taint, toleration</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#cordon-uncordon" title="cordon, uncordon">cordon, uncordon</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#drain" title="drain">drain</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#references" title="References">References</a></div></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8><li class="contact-item" data-v-3d9deeb8><a href="https://github.com/jiyeonseo" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-3d9deeb8><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-3d9deeb8></path></svg>
          
        </a></li><li class="contact-item" data-v-3d9deeb8><a href="https://twitter.com/seojeee" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter" data-v-3d9deeb8><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z" data-v-3d9deeb8></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8><li class="copyright-item" data-v-3d9deeb8>Copyright © Jiyeon Seo 2020</li></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ca882463.js" defer></script><script src="/assets/js/4.d48376ce.js" defer></script><script src="/assets/js/1.a7328d07.js" defer></script><script src="/assets/js/108.9c79596c.js" defer></script>
  </body>
</html>
